<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller=function($scope, spUtil) {
  /* widget controller */
  var c = this;
	alert('CLIENT SCRIPT LOADED');
	 $scope.selectedCourse = {};
    $scope.enrollment = {};

    $scope.enroll = function (course) {
			alert('enroll button clicked');
			console.log(course);
        $scope.selectedCourse = course;
        $scope.enrollment = {};
        $('#enrollModal').modal('show');
    };

    $scope.submitEnrollment = function () {
			alert('sublit button clicked');
        spUtil.update($scope, {
            action: 'enroll',
            course_id: $scope.selectedCourse.sys_id,
           enrollment: {
                full_name: $scope.enrollment.full_name,
                email: $scope.enrollment.email,
                mobile: $scope.enrollment.mobile
            }
        }).then(function () {
            $('#enrollModal').modal('hide');
            spUtil.addInfoMessage('Enrollment submitted successfully. Payment pending.');
        });
    };
	
	$scope.testServer = function () {
		alert('test button clicked');
        spUtil.update($scope, {
            action: 'test'
        });
    };
	
};]]></client_script>
        <controller_as>c</controller_as>
        <css/>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id>course_list_items</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>course_list_items</name>
        <option_schema/>
        <public>true</public>
        <roles/>
        <script><![CDATA[(function() {
  /* populate the 'data' object */
  /* e.g., data.table = $sp.getValue('table'); */
	
	data.courses = [];

    var gr = new GlideRecord('x_528401_course_ma_courses');
    gr.addQuery('is_active', true);
    gr.orderBy('course_name');
    gr.query();

    while (gr.next()) {
        data.courses.push({
            sys_id: gr.getUniqueValue(),
            name: gr.getValue('course_name'),
            description: gr.getValue('description'),
            cost: gr.getValue('course_cost'),
            timings: gr.getValue('schedule_timings'),
            location: gr.getValue('location')
        });
    }
	
	if (input && input.action === 'enroll') {
		gs.log(input.action);
    gs.addInfoMessage(input.action);
    var enr = new GlideRecord('x_528401_course_ma_enrollments');
    enr.initialize();

    enr.course = input.course_id;
    enr.student_name = input.enrollment.full_name;
    enr.email_address = input.enrollment.email;
    enr.mobile_number = input.enrollment.mobile;

    enr.enrollment_status = 'pending_payment';
    enr.payment_confirmed = false;

    enr.insert();
}
	
	if (input && input.action === 'test') {
		    gs.addInfoMessage('SERVER HIT SUCCESS')
        gs.info('SERVER HIT SUCCESS');
    }
	

})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2025-12-19 15:36:44</sys_created_on>
        <sys_id>477818e3833d3210d3241080deaad396</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>course_list_items</sys_name>
        <sys_package display_value="Course Manag" source="x_528401_course_ma">2895117683b13210d3241080deaad302</sys_package>
        <sys_policy/>
        <sys_scope display_value="Course Manag">2895117683b13210d3241080deaad302</sys_scope>
        <sys_update_name>sp_widget_477818e3833d3210d3241080deaad396</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-12-19 15:36:44</sys_updated_on>
        <template><![CDATA[<div>
<button class="btn btn-danger" ng-click="testServer()">
  Test Server Call
</button>  
</div>
<div class="row">
  <div class="col-md-4" ng-repeat="course in data.courses">
    <div class="panel panel-default">
      <div class="panel-heading">
        <strong>{{course.name}}</strong>
      </div>
      <div class="panel-body">
        <p>{{course.description}}</p>
        <p><b>Timings:</b> {{course.timings}}</p>
        <p><b>Cost:</b> â‚¹{{course.cost}}</p>
        <button class="btn btn-primary btn-block"
                ng-click="enroll(course)">
          Enroll
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Enroll Modal -->
<div id="enrollModal" class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h4>Enroll: {{selectedCourse.name}}</h4>
      </div>

      <div class="modal-body">
        <input class="form-control" placeholder="Full Name"
               ng-model="enrollment.full_name"><br>

        <input class="form-control" placeholder="Email"
               ng-model="enrollment.email"><br>

        <input class="form-control" placeholder="Mobile Number"
               ng-model="enrollment.mobile">
      </div>

      <div class="modal-footer">
        <button class="btn btn-success"
                ng-click="submitEnrollment()">
          Submit
        </button>
      </div>

    </div>
  </div>
</div>
]]></template>
    </sp_widget>
</record_update>
